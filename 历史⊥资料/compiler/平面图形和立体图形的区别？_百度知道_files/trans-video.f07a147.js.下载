define("question-new:widget/js/trans-video/trans-video",function(e,t,i){var a=e("common:widget/js/util/tangram/tangram"),o=e("common:widget/js/util/log/log"),n=e("question-new:widget/videos/js/cyberplayer"),d=e("question-new:widget/js/trans-video/intersection-observer"),r={},s=function(e,t){this.init=function(e,t){var i=this;window.IntersectionObserver||d.init(),window.onbeforeunload||(window.onbeforeunload=function(){var e=0;for(var t in r)r[t].totalPlayTime&&o.send({mid:t,originDuration:r[t].duration,totalPlayTime:r[t].totalPlayTime,page:"qb",qid:F.context("page").qid,rid:r[t].rid,isFirst:+(0===e)}),e++}),e&&t?i.createPlayer(e,t):i.createPlayers(e)};var i=a(body).find("#wgt-best"),s=a(body).find("#wgt-answers"),c=i.find("vvideo"),l=s.find("vvideo"),m=document.getElementById(e);(i.length&&c.length&&m===i[0]||s.length&&l.length&&!c.length&&m===s[0])&&(this.isFirst=1),this.createPlayers=function(e){var t=this,i=a(document.getElementById(e)),d=i.find("vvideo");d.length>0&&(o.addKey({isVideo:"isVideo"}),o.send({videoQb:"video-qb-answer",page:"qb",module:"qb-answer-video",action:"pv",qid:F.context("page").qid}));for(var s=0;s<d.length;s++){var c=d[s].id,l=d[s].getAttribute("src"),m=d[s].getAttribute("img"),u=d[s].getAttribute("mid"),g=d[s].getAttribute("rid"),p=d[s].getAttribute("topicName"),y=d[s].getAttribute("topicImg"),v=d[s].getAttribute("duration"),b=+d[s].getAttribute("transcodeStatus")||0,h=2===b||4===b;r[c]={duration:v,rid:g},function(i,d,s,c,p){t[i]=n(i).setup({flashplayer:"https://gss0.bdstatic.com/7051cy89QMgCncy6lo7D0j9wexYrbOWh7c50/videoPage/cyberplayer.flash.swf",width:519,height:310,autostart:!1,stretching:"uniform",volume:100,controls:!0,repeat:!1,controlbar:{barlogo:!0},repeat:!0,starttime:0,image:m,file:l,ak:""}).on("ready",function(){a(body).find(".jw-warning").each(function(){a(this).hide()}),a(body).find(".machine-recommend-image-icon").each(function(){a(this).hide()});var e=document.getElementById(i),n=d?"12px;":"15px;",r="margin-bottom:"+n+"position: relative;"+e.getAttribute("style");e.setAttribute("style",r);var l=e.querySelector(".jw-display-icon-container");e.querySelector(".jw-media").id=""+i,a(l).hide();var m=document.createElement("div");if(m.setAttribute("class","play-icon"),e.appendChild(m),p&&a(m).click(function(){t[i].play()}),!p){var u=document.createElement("div");a(u).css({width:"100%",height:"100%",position:"absolute",zIndex:2,top:0,left:0}),e.appendChild(u)}if(d){var g=document.createElement("div");g.className="video-topic";var y='<img class="video-topic-icon" height="15" width="15" src="'+(s||"https://gss0.bdstatic.com/7051cy89RcgCncy6lo7D0j9wexYrbOWh7c50/iknow/video-topic/video-topic-icon-default.svg")+'"><span class="topic-name">'+d+"</span>";g.innerHTML=y,e.parentNode.insertBefore(g,e.nextSibling)}var v=new IntersectionObserver(function(e){e=e[0];var i=e.target.id;e.intersectionRatio&&(o.send({mid:i,count:1,page:"qb",module:"qb-answer-video",qid:F.context("page").qid,isFirst:t.isFirst&&!c?1:0}),v.disconnect())});v.observe(document.getElementById(""+i))}).on("play",function(n){"buffering"===n.oldstate&&o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:g,mid:i,action:"videoplay",duration:v});var d=document.getElementById(i).querySelector(".play-icon");a(d).hide(),t[i].start=+new Date,t[i].totalPlayTime=t[i].totalPlayTime||0,r[i].totalPlayTime=t[i].totalPlayTime||0}).on("time",function(a){t[i].duration=a.position,t[i].totalPlayTime+=+new Date-t[i].start,r[i].totalPlayTime=t[i].totalPlayTime,t[i].start=+new Date,a.position>3&&!t[i].hasPlayed&&(t[i].hasPlayed=!0,o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:g,action:"play",mid:i}))}).on("pause",function(){t[i].totalPlayTime+=+new Date-t[i].start,r[i].totalPlayTime=t[i].totalPlayTime,t[i].status="pause",t[i].duration>3&&o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:g,action:"duration",duration:t[i].duration,totalPlayTime:t[i].totalPlayTime,mid:i,isFirst:t.isFirst&&!c?1:0})}).on("complete",function(){t[i].status="complete",t[i].totalPlayTime+=+new Date-t[i].start,r[i].totalPlayTime=t[i].totalPlayTime,t[i].duration>3&&o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:g,action:"duration",duration:t[i].duration,totalPlayTime:t[i].totalPlayTime,mid:i,isFirst:t.isFirst&&!c?1:0}),o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:g,action:"totalPlayTime",totalPlayTime:t[i].totalPlayTime,mid:i,duration:v})}).on("error",function(){o.send({action:"video-play-error",area:"qb-pc",qid:F.context("page").qid,mid:i,rid:g})}),o.send({page:"qb",module:"qb-answer-video",qid:F.context("page").qid,area:e,rid:g,mid:u,action:"pv"})}(c,p,y,s,h)}},this.createPlayer=function(e,t){o.send({area:"ask-video",action:"pv",mid:t.mid,originDuration:t.duration,isVertical:t.height>t.width});var i=this,d=+t.transcodeStatus||0,r=2===d||4===d;i[e]=n(e).setup({flashplayer:"https://gss0.bdstatic.com/7051cy89QMgCncy6lo7D0j9wexYrbOWh7c50/videoPage/cyberplayer.flash.swf",width:519,height:310,autostart:!1,stretching:"uniform",volume:100,controls:!0,repeat:!1,controlbar:{barlogo:!0},repeat:!0,starttime:0,image:t.cover_img,file:t.video_url,ak:""}).on("ready",function(){a(body).find(".jw-warning").each(function(){a(this).hide()}),a(body).find(".machine-recommend-image-icon").each(function(){a(this).hide()});var t=document.getElementById(e).querySelector(".jw-display-icon-container");a(t).hide();var n=document.createElement("div");if(n.setAttribute("class","play-icon"),document.getElementById(e).appendChild(n),r&&a(n).click(function(){i[e].play()}),!r){var d=document.createElement("div");a(d).css({width:"100%",height:"100%",position:"absolute",zIndex:2,top:0,left:0}),document.getElementById(e).appendChild(d)}var s=new IntersectionObserver(function(e){e=e[0];var t=e.target.id;e.intersectionRatio&&(o.send({mid:t,count:1,page:"qb",module:"qb-ask-video",qid:F.context("page").qid}),s.disconnect())});s.observe(document.getElementById("videoBox"))}).on("play",function(){var t=document.getElementById(e).querySelector(".play-icon");a(t).hide()}).on("time",function(a){i.duration=a.position,a.position>3&&!i.hasPlayed&&(i.hasPlayed=!0,o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,action:"play",mid:t.mid}))}).on("pause",function(){i.duration>3&&o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,action:"duration",duration:i.duration,mid:t.mid})}).on("complete",function(){i.duration>3&&o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,action:"duration",duration:i.duration,mid:t.mid})}),o.addKey({isVideo:"isVideo"}),o.send({page:"qb",module:"qb-ask-video",qid:F.context("page").qid,area:e,mid:t.mid,action:"pv",videoQb:"video-qb-ask"})},this.init(e,t)};i.exports=s});